<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SotonFind - Create Report</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fb;
            overflow-x: hidden;
        }
        
        /* Sidebar styles */
        .sidebar {
            height: 100vh;
            background: linear-gradient(180deg, #4f46e5 0%, #3b82f6 100%);
            transition: all 0.3s;
            box-shadow: 4px 0 10px rgba(0, 0, 0, 0.05);
            position: fixed;
            left: 0;
            z-index: 30;
        }
        
        .sidebar-collapsed {
            width: 80px;
        }
        
        .sidebar-expanded {
            width: 250px;
        }
        
        .sidebar-link {
            color: white;
            border-radius: 8px;
            transition: all 0.2s;
            margin: 5px 12px;
        }
        
        .sidebar-link:hover, .sidebar-link.active {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        /* Header styles */
        .header {
            background-color: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #e5e7eb;
        }
        
        /* Card styles */
        .card {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            transition: all 0.3s;
        }
        
        /* Button styles */
        .btn-primary {
            background-color: #3b82f6;
            color: white;
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.2);
        }
        
        .btn-primary:hover {
            background-color: #2563eb;
            transform: translateY(-2px);
            box-shadow: 0 8px 15px -3px rgba(59, 130, 246, 0.3);
        }
        
        .btn-secondary {
            background-color: white;
            color: #374151;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-secondary:hover {
            background-color: #f9fafb;
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        .btn-danger {
            background-color: #f3f4f6;
            color: #ef4444;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-danger:hover {
            background-color: #fee2e2;
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }
        
        /* Animation */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Sidebar text transitions */
        .sidebar-text {
            transition: opacity 0.3s, width 0.3s;
            white-space: nowrap;
            overflow: hidden;
        }
        
        .sidebar-collapsed .sidebar-text {
            opacity: 0;
            width: 0;
            display: none;
        }
        
        .sidebar-collapsed .link-text {
            opacity: 0;
            width: 0;
            display: none;
        }

        /* Custom file upload styles */
        .file-upload-container {
            border: 2px dashed #e5e7eb;
            border-radius: 12px;
            background-color: #f9fafb;
            transition: all 0.3s;
        }

        .file-upload-container:hover, .file-upload-container.dragover {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }

        .file-preview {
            height: 100px;
            border-radius: 8px;
            object-fit: cover;
        }

        /* Progress bar styles */
        .progress-container {
            width: 100%;
            height: 8px;
            background-color: #e5e7eb;
            border-radius: 4px;
            margin-top: 5px;
        }

        .progress-bar {
            height: 8px;
            background-color: #3b82f6;
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        /* Report type selector styles */
        .report-type-selector {
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .report-type-selector:hover {
            transform: translateY(-5px);
        }

        .report-type-selector.selected {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }

        .report-icon {
            transition: all 0.3s;
        }

        .report-type-selector:hover .report-icon {
            transform: scale(1.1);
        }
    </style>
</head>
<body>
    <div class="flex h-screen">
        <!-- Sidebar -->
        <div id="sidebar" class="sidebar sidebar-expanded">
            <!-- Logo -->
            <div class="p-2 pt-6 pl-4 flex items-center justify-between">
                <div class="flex items-center">
                    <div class="h-10 w-10 flex items-center justify-center bg-white rounded-xl">
                        <i class="fas fa-search text-blue-600 text-xl"></i>
                    </div>
                    <h1 class="ml-3 text-white text-xl font-bold sidebar-text">SotonFind</h1>
                </div>
                <button id="toggleSidebar" class="text-white hover:bg-blue-700 rounded-full p-2">
                    <i class="fas fa-chevron-left"></i>
                </button>
            </div>
            
            <!-- Menu Links -->
            <div class="mt-8">
                <a href="lost-items.html" class="sidebar-link flex items-center py-3 px-4 mb-2">
                    <i class="fas fa-search-minus text-xl w-8"></i>
                    <span class="ml-3 link-text">Lost Items</span>
                </a>
                
                <a href="found-items.html" class="sidebar-link flex items-center py-3 px-4 mb-2">
                    <i class="fas fa-search-plus text-xl w-8"></i>
                    <span class="ml-3 link-text">Found Items</span>
                </a>
                
                <a href="my-reports.html" class="sidebar-link active flex items-center py-3 px-4 mb-2">
                    <i class="fas fa-clipboard-list text-xl w-8"></i>
                    <span class="ml-3 link-text">My Reports</span>
                </a>

                <div class="border-t border-blue-400 my-4 opacity-30"></div>

                <a href="user-profile.html" class="sidebar-link flex items-center py-3 px-4 mb-2">
                    <i class="fas fa-user text-xl w-8"></i>
                    <span class="ml-3 link-text">My Profile</span>
                </a>

                <a href=# class="sidebar-link flex items-center py-3 px-4 mb-2" id="logout">
                    <i class="fas fa-sign-out-alt text-xl w-8"></i>
                    <span class="ml-3 link-text">Logout</span>
                </a>
            </div>
        </div>

        <!-- Main Content -->
        <div id="main-content" class="flex-1 ml-64 transition-all duration-300">
            <!-- Header -->
            <header class="header w-full flex items-center justify-between px-6 py-4 top-0 z-20">
                <div class="flex pr-4 items-center">
                    <h2 class="text-xl font-bold text-gray-800">Create a Report</h2>
                </div>
                
                <div class="flex items-center space-x-4">
                    <a href="user-profile.html">
                        <div class="flex items-center bg-gray-100 hover:bg-gray-200 rounded-full p-1 pl-3 cursor-pointer">
                            <span id="username" class="text-sm font-medium mr-2"></span>
                            <img id="profile-pic" src="https://static.vecteezy.com/system/resources/thumbnails/003/031/764/small/blue-wide-background-with-linear-blurred-gradient-free-vector.jpg" alt="User" class="user-avatar">
                        </div>
                    </a>
                </div>
            </header>

            <!-- Page Content -->
            <main class="pt-4 px-6 pb-8 fade-in">
                <!-- Report Type Selection -->
                <div class="card p-6 mb-6">
                    <div class="flex items-center mb-6">
                        <div class="bg-blue-100 p-3 rounded-full mr-4">
                            <i class="fas fa-clipboard-list text-blue-600"></i>
                        </div>
                        <div>
                            <h2 class="text-xl font-bold text-gray-800">What type of report would you like to create?</h2>
                            <p class="text-gray-600">Choose whether you are reporting a lost or found item</p>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Lost Item Option -->
                        <div id="lostOption" class="report-type-selector rounded-xl p-6 text-center">
                            <div class="bg-red-100 mx-auto rounded-full h-24 w-24 flex items-center justify-center mb-4">
                                <i class="fas fa-search-minus text-red-600 text-4xl report-icon"></i>
                            </div>
                            <h3 class="text-lg font-bold text-gray-800 mb-2">I've Lost Something</h3>
                            <p class="text-gray-600 mb-4">Report an item you've lost and see if someone has found it</p>
                            <button class="btn-primary bg-red-500 hover:bg-red-600">
                                <i class="fas fa-plus mr-2"></i>Report Lost Item
                            </button>
                        </div>

                        <!-- Found Item Option -->
                        <div id="foundOption" class="report-type-selector rounded-xl p-6 text-center">
                            <div class="bg-green-100 mx-auto rounded-full h-24 w-24 flex items-center justify-center mb-4">
                                <i class="fas fa-search-plus text-green-600 text-4xl report-icon"></i>
                            </div>
                            <h3 class="text-lg font-bold text-gray-800 mb-2">I've Found Something</h3>
                            <p class="text-gray-600 mb-4">Report an item you've found to help reunite it with its owner</p>
                            <button class="btn-primary bg-green-500 hover:bg-green-600">
                                <i class="fas fa-plus mr-2"></i>Report Found Item
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Lost Item Form (initially hidden) -->
                <div id="lostItemForm" class="card p-6 mb-8 hidden">
                    <div class="flex items-center mb-6">
                        <div class="bg-red-100 p-3 rounded-full mr-4">
                            <i class="fas fa-search-minus text-red-600"></i>
                        </div>
                        <div>
                            <h2 class="text-xl font-bold text-gray-800">Report Lost Item</h2>
                            <p class="text-gray-600">Fill in the details about the item you have lost</p>
                        </div>
                    </div>

                    <form id="reportLostForm">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <!-- Item Name -->
                            <div>
                                <label for="lostItemName" class="block text-sm font-medium text-gray-700 mb-2">Item Name*</label>
                                <input type="text" id="lostItemName" name="itemName" required
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-colors">
                            </div>

                            <!-- Item Category -->
                            <div>
                                <label for="lostItemCategory" class="block text-sm font-medium text-gray-700 mb-2">Item Category*</label>
                                <select id="lostItemCategory" name="itemCategory" required
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-colors">
                                    <option value="" disabled selected>Select a category</option>
                                    <option value="electronics">Electronics</option>
                                    <option value="clothing">Clothing</option>
                                    <option value="accessories">Accessories</option>
                                    <option value="documents">Documents/ID</option>
                                    <option value="keys">Keys</option>
                                    <option value="bags">Bags/Backpacks</option>
                                    <option value="books">Books/Notes</option>
                                    <option value="jewelry">Jewelry</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>

                            <!-- Color -->
                            <div>
                                <label for="lostColor" class="block text-sm font-medium text-gray-700 mb-2">Color</label>
                                <input type="text" id="lostColor" name="color"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-colors">
                            </div>

                            <!-- Location -->
                            <div>
                                <label for="lostLocation" class="block text-sm font-medium text-gray-700 mb-2">Last Seen Location*</label>
                                <input type="text" id="lostLocation" name="location" required
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-colors">
                            </div>

                            <!-- Date Lost -->
                            <div>
                                <label for="dateLost" class="block text-sm font-medium text-gray-700 mb-2">Date Lost*</label>
                                <input type="date" id="dateLost" name="dateLost" required
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-colors">
                            </div>

                            <!-- Contact Method
                            <div>
                                <label for="lostContactMethod" class="block text-sm font-medium text-gray-700 mb-2">Preferred Contact Method*</label>
                                <select id="lostContactMethod" name="contactMethod" required
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-colors">
                                    <option value="" disabled selected>Select contact method</option>
                                    <option value="email">Email</option>
                                    <option value="phone">Phone</option>
                                    <option value="app">In-app messaging</option>
                                </select>
                            </div> -->
                        </div>

                        <!-- Description -->
                        <div class="mb-6">
                            <label for="lostDescription" class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                            <textarea id="lostDescription" name="description" rows="4"
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-colors resize-y"></textarea>
                            <p class="text-xs text-gray-500 mt-1">Provide specific details that could help identify your item (avoid sharing sensitive personal details)</p>
                        </div>

                        <!-- Image Upload -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Images</label>
                            <div id="lostDropArea" class="file-upload-container p-6 text-center cursor-pointer">
                                <i class="fas fa-cloud-upload-alt text-red-500 text-3xl mb-2"></i>
                                <p class="text-gray-700 mb-1">Drag & drop images here or click to browse</p>
                                <p class="text-xs text-gray-500">Upload up to 5 images (JPEG, PNG)</p>
                                <input type="file" id="lostFileInput" multiple accept="image/*" class="hidden">
                            </div>
                            
                            <!-- Preview Container -->
                            <div id="lostPreviewContainer" class="mt-4 grid grid-cols-2 md:grid-cols-5 gap-3 hidden">
                                <!-- Preview images will be added here dynamically -->
                            </div>
                        </div>

                        <!-- Buttons -->
                        <div class="flex justify-end space-x-4 mt-8">
                            <button type="button" class="btn-danger lostCancelButton">
                                <i class="fas fa-times mr-2"></i>Cancel
                            </button>
                            <button type="submit" class="btn-primary bg-red-500 hover:bg-red-600">
                                <i class="fas fa-check mr-2"></i>Submit Report
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Found Item Form (initially hidden) -->
                <div id="foundItemForm" class="card p-6 mb-8 hidden">
                    <div class="flex items-center mb-6">
                        <div class="bg-green-100 p-3 rounded-full mr-4">
                            <i class="fas fa-search-plus text-green-600"></i>
                        </div>
                        <div>
                            <h2 class="text-xl font-bold text-gray-800">Report Found Item</h2>
                            <p class="text-gray-600">Fill in the details about the item you have found</p>
                        </div>
                    </div>

                    <form id="reportFoundForm">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <!-- Item Name -->
                            <div>
                                <label for="itemName" class="block text-sm font-medium text-gray-700 mb-2">Item Name*</label>
                                <input type="text" id="itemName" name="itemName" required
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors">
                            </div>

                            <!-- Item Category -->
                            <div>
                                <label for="itemCategory" class="block text-sm font-medium text-gray-700 mb-2">Item Category*</label>
                                <select id="itemCategory" name="itemCategory" required
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors">
                                    <option value="" disabled selected>Select a category</option>
                                    <option value="electronics">Electronics</option>
                                    <option value="clothing">Clothing</option>
                                    <option value="accessories">Accessories</option>
                                    <option value="documents">Documents/ID</option>
                                    <option value="keys">Keys</option>
                                    <option value="bags">Bags/Backpacks</option>
                                    <option value="books">Books/Notes</option>
                                    <option value="jewelry">Jewelry</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>

                            <!-- Color -->
                            <div>
                                <label for="color" class="block text-sm font-medium text-gray-700 mb-2">Color</label>
                                <input type="text" id="color" name="color"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors">
                            </div>

                            <!-- Location -->
                            <div>
                                <label for="location" class="block text-sm font-medium text-gray-700 mb-2">Location Found*</label>
                                <input type="text" id="location" name="location" required
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors">
                            </div>

                            <!-- Date Found -->
                            <div>
                                <label for="dateFound" class="block text-sm font-medium text-gray-700 mb-2">Date Found*</label>
                                <input type="date" id="dateFound" name="dateFound" required
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors">
                            </div>

                            <!-- Current Location -->
                            <div>
                                <label for="currentLocation" class="block text-sm font-medium text-gray-700 mb-2">Current Item Location*</label>
                                <select id="currentLocation" name="currentLocation" required
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors">
                                    <option value="" disabled selected>Select current location</option>
                                    <option value="with_me">I'm keeping it safe</option>
                                    <option value="campus_security">Handed to Campus Security</option>
                                    <option value="library">Left at Library Reception</option>
                                    <option value="student_union">Left at Student Union</option>
                                    <option value="other">Other (specify in description)</option>
                                </select>
                            </div>
                        </div>

                        <!-- Description -->
                        <div class="mb-6">
                            <label for="description" class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                            <textarea id="description" name="description" rows="4"
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors resize-y"></textarea>
                            <p class="text-xs text-gray-500 mt-1">Provide details that might help identify the owner (avoid sharing sensitive personal details)</p>
                        </div>

                        <!-- Image Upload -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Images</label>
                            <div id="dropArea" class="file-upload-container p-6 text-center cursor-pointer">
                                <i class="fas fa-cloud-upload-alt text-green-500 text-3xl mb-2 upload-prompt"></i>
                                <p class="text-gray-700 mb-1 upload-prompt">Drag & drop images here or click to browse</p>
                                <p class="text-xs text-gray-500 upload-prompt">Upload up to 5 images (JPEG, PNG)</p>
                                <input type="file" id="fileInput" multiple accept="image/*" class="hidden">
                            </div>
                            
                            <!-- Preview Container -->
                            <div id="previewContainer" class="mt-4 grid grid-cols-2 md:grid-cols-5 gap-3 hidden">
                                <!-- Preview images will be added here dynamically -->
                            </div>
                        </div>

                        <!-- Buttons -->
                        <div class="flex justify-end space-x-4 mt-8">
                            <button type="button" id="cancelButton" class="btn-danger">
                                <i class="fas fa-times mr-2"></i>Cancel
                            </button>
                            <button type="submit" class="btn-primary bg-green-500 hover:bg-green-600">
                                <i class="fas fa-check mr-2"></i>Submit Report
                            </button>
                        </div>
                    </form>
                </div>
            </main>
        </div>
    </div>

    <script>
        // Sidebar toggle functionality
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('main-content');
        const toggleBtn = document.getElementById('toggleSidebar');
        
        toggleBtn.addEventListener('click', () => {
            if (sidebar.classList.contains('sidebar-expanded')) {
                // Collapse sidebar
                sidebar.classList.remove('sidebar-expanded');
                sidebar.classList.add('sidebar-collapsed');
                mainContent.classList.remove('ml-64');
                mainContent.classList.add('ml-20');
                toggleBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
            } else {
                // Expand sidebar
                sidebar.classList.remove('sidebar-collapsed');
                sidebar.classList.add('sidebar-expanded');
                mainContent.classList.remove('ml-20');
                mainContent.classList.add('ml-64');
                toggleBtn.innerHTML = '<i class="fas fa-chevron-left"></i>';
            }
        });

        // Report type selection
        const lostOption = document.getElementById('lostOption');
        const foundOption = document.getElementById('foundOption');
        const lostItemForm = document.getElementById('lostItemForm');
        const foundItemForm = document.getElementById('foundItemForm');
        const reportTypeCard = document.querySelector('.card');

        lostOption.querySelector('button').addEventListener('click', () => {
            reportTypeCard.classList.add('hidden');
            lostItemForm.classList.remove('hidden');
        });

        foundOption.querySelector('button').addEventListener('click', () => {
            reportTypeCard.classList.add('hidden');
            foundItemForm.classList.remove('hidden');
        });

        // Cancel buttons return to report type selection
        document.querySelectorAll('.lostCancelButton, #cancelButton').forEach(button => {
            button.addEventListener('click', () => {
                if (confirm('Are you sure you want to cancel? All entered data will be lost.')) {
                    lostItemForm.classList.add('hidden');
                    foundItemForm.classList.add('hidden');
                    reportTypeCard.classList.remove('hidden');
                }
            });
        });

        // Reusable file upload functionality
        function setupFileUpload(dropAreaId, fileInputId, previewContainerId, maxFiles = 5) {
            const dropArea = document.getElementById(dropAreaId);
            const fileInput = document.getElementById(fileInputId);
            const previewContainer = document.getElementById(previewContainerId);
            let uploadedFiles = [];

            // Open file dialog when clicking on drop area
            dropArea.addEventListener('click', () => {
                fileInput.click();
            });
            // dropArea.addEventListener('click', (e) => {
            //     // Only trigger file input if clicking on the drop area itself (not previews)
            //     if (e.target === dropArea || 
            //         e.target.closest('.upload-prompt')) { // Add a class to your upload prompt elements
            //         fileInput.click();
            //     }
            // });
            

            // Handle file selection
            fileInput.addEventListener('change', (e) => handleFiles(e));

            // Prevent default drag behaviors
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            // Highlight drop area when item is dragged over it
            ['dragenter', 'dragover'].forEach(eventName => {
                dropArea.addEventListener(eventName, highlight, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, unhighlight, false);
            });

            function highlight() {
                dropArea.classList.add('dragover');
            }

            function unhighlight() {
                dropArea.classList.remove('dragover');
            }

            // Handle dropped files
            dropArea.addEventListener('drop', handleDrop, false);

            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                handleFiles({ target: { files } });
            }

            function handleFiles(e) {
                const files = e.target?.files || e;
                if (files.length + uploadedFiles.length > maxFiles) {
                    alert(`You can only upload up to ${maxFiles} images.`);
                    return;
                }
                
                previewContainer.classList.remove('hidden');
                
                for (let i = 0; i < files.length; i++) {
                    if (uploadedFiles.length >= maxFiles) break;
                    
                    const file = files[i];
                    if (!file.type.match('image.*')) continue;
                    
                    uploadedFiles.push(file);
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        const preview = createPreviewElement(e.target.result, file.name, uploadedFiles.length - 1);
                        previewContainer.appendChild(preview);
                        simulateUpload(preview.querySelector('.progress-bar'));
                    }
                    
                    reader.readAsDataURL(file);
                }
            }

            function createPreviewElement(imgSrc, fileName, index) {
                const div = document.createElement('div');
                div.className = 'relative';
                div.innerHTML = `
                    <div class="bg-white p-2 rounded-lg shadow-sm">
                        <img src="${imgSrc}" alt="${fileName}" class="file-preview w-full mb-2">
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-gray-500 truncate" style="max-width: 100px;">${fileName}</span>
                            <button type="button" class="text-red-500 hover:text-red-700" data-index="${index}">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                        <div class="progress-container">
                            <div class="progress-bar" style="width: 0%"></div>
                        </div>
                    </div>
                `;
                
                // Add remove functionality
                div.querySelector('button').addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    removeFile(index, div);
                });
                
                return div;
            }

            function removeFile(index, element) {
                uploadedFiles.splice(index, 1);
                element.remove();
                
                // Reindex remaining buttons
                const buttons = previewContainer.querySelectorAll('button');
                buttons.forEach((button, i) => {
                    button.setAttribute('data-index', i);
                });
                
                if (uploadedFiles.length === 0) {
                    previewContainer.classList.add('hidden');
                }
            }

            function simulateUpload(progressBar) {
                let width = 0;
                const interval = setInterval(() => {
                    if (width >= 100) {
                        clearInterval(interval);
                    } else {
                        width += Math.random() * 10;
                        if (width > 100) width = 100;
                        progressBar.style.width = width + '%';
                    }
                }, 200);
            }
            
            // Return methods that might be needed externally
            return {
                getFiles: () => uploadedFiles,
                clearFiles: () => {
                    uploadedFiles = [];
                    previewContainer.innerHTML = '';
                    previewContainer.classList.add('hidden');
                }
            };
        }

        // // Usage:
        // // File upload functionality for found items
        const foundItemUploader = setupFileUpload('dropArea', 'fileInput', 'previewContainer');

        // File upload functionality for lost items
        const lostItemUploader = setupFileUpload('lostDropArea', 'lostFileInput', 'lostPreviewContainer');

        // You can now access the uploaded files or clear them when needed
        // Example: const foundFiles = foundItemUploader.getFiles();
        // Example: lostItemUploader.clearFiles();
    </script>

    <!-- Check if a user is logged in, Update user profile -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-auth.js";
        import { 
            getFirestore, doc, getDoc,
            collection, addDoc, Timestamp, serverTimestamp
         } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-firestore.js"

        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyBBTdHvzVHcGhObHG-WbLyumrgRhDgZRJE",
            authDomain: "lostfounditemmanagement.firebaseapp.com",
            projectId: "lostfounditemmanagement",
            storageBucket: "lostfounditemmanagement.firebasestorage.app",
            messagingSenderId: "126221630339",
            appId: "1:126221630339:web:bf4463bd1fb91d023714b6",
            measurementId: "G-6PZ5MTYJLQ"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        window.Timestamp = Timestamp;
        window.serverTimestamp = serverTimestamp;
        
        // Check if a user is logged in
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                // User is logged in, proceed with displaying content
                console.log("✅ User already logged in to Create Report:", user.email);
            
                // Get user profile data from Firestore
                try {
                    const userRef = doc(db, "users", user.uid);
                    const userDoc = await getDoc(userRef);

                    if (userDoc.exists()) {
                        const userData = userDoc.data();

                        // Update header user profile
                        const usernameElement = document.getElementById("username");
                        const profilePicElement = document.getElementById('profile-pic');

                        // Set username from Firestore
                        // usernameElement.textContent = userData.username || 'Anonymous';
                        usernameElement.textContent = userData.username || 'Anonymous';

                        // Set profile picture with fallback
                        profilePicElement.src = userData.photoURL || 'https://static.vecteezy.com/system/resources/thumbnails/003/031/764/small/blue-wide-background-with-linear-blurred-gradient-free-vector.jpg';

                    } else {
                        // User is not logged in, redirect to login page
                        console.log("⚠️ User data not found in Firestore.");
                        setDefaultUserInfo();
                    }

                } catch (error) {
                    console.error("❌ Error fetching user data:", error);
                    setDefaultUserInfo()
                }        
            } else {
                // User not logged in, redirect to login
                console.log("🚫 No user is logged in.")
                window.location.href = 'auth.html';
            }
        });

        function setDefaultUserInfo() {
            document.getElementById("username").textContent = 'Anonymous';
            document.getElementById("profile-pic").src = 'https://static.vecteezy.com/system/resources/thumbnails/003/031/764/small/blue-wide-background-with-linear-blurred-gradient-free-vector.jpg';
        }

        // Logout handler
        document.getElementById("logout").addEventListener("click", (e) => {
            e.preventDefault(); // prevent default link behavior
            signOut(auth).then(() => {
                window.location.href = "auth.html";
            }).catch((error) => {
                console.error("❌ Logout Error:", error);
            });
        });

        // Form submission logic
        document.getElementById('reportFoundForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Get form values (backend)
            const itemName = document.getElementById('itemName').value;
            const itemCategory = document.getElementById('itemCategory').value;
            const color = document.getElementById('color').value;
            const location = document.getElementById('location').value;
            const dateFound = document.getElementById('dateFound').value;
            const currentLocation = document.getElementById('currentLocation').value;
            const description = document.getElementById('description').value;
            const user = auth.currentUser;
            const userRef = doc(db, "users", user.uid);

            if (!user) {
                alert("Please log in to submit a found report.");
                return;
            }

            // Set uploaded files
            const files = foundItemUploader.getFiles();

            try {
                // Upload image to Cloudinary
                const imageURLs = [];
                for (const file of files) {
                    const formData = new FormData();
                    formData.append('file', file);
                    formData.append('upload_preset', 'lost_found_upload');

                    const response = await fetch('https://api.cloudinary.com/v1_1/dnshn1lze/image/upload', {
                        method: "POST",
                        body: formData
                    });

                    const data = await response.json();
                    if (!data.secure_url) throw new Error('Image upload failed');
                    imageURLs.push(data.secure_url);
                }

                // prepare Firestore found report data
                const reportData = {
                    itemCategory: itemCategory,
                    itemColor: color,
                    dateFound: Timestamp.fromDate(new Date(dateFound)),
                    description: description,
                    images: imageURLs,
                    itemName: itemName,
                    locationFound: location, 
                    userRef: userRef,
                    currentLocation: currentLocation,
                    createdAt: serverTimestamp()
                };

                // Save to Firestore
                const db = getFirestore();
                const docRef = await addDoc(collection(db, 'foundItems'), reportData);

            
                // Show success message (simulated)
                foundItemForm.innerHTML = `
                    <div class="text-center py-8">
                        <div class="bg-green-100 p-3 rounded-full inline-flex items-center justify-center mb-4">
                            <i class="fas fa-check-circle text-green-600 text-4xl"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">Report Submitted Successfully!</h2>
                        <p class="text-gray-600 mb-6">Thank you for helping return this item to its owner.</p>
                        <div class="flex justify-center">
                            <button id="returnHome" class="btn-primary">
                                <i class="fas fa-home mr-2"></i>Return to Home
                            </button>
                        </div>
                    </div>
                `;
                
                console.log('Found Report Created Successfully by ', user.uid);

            // Add event listener to new button
                document.getElementById('returnHome').addEventListener('click', function() {
                    window.location.href = 'my-reports.html';
                });

            } catch (error) {
                console.error('Submission error: ', error);
                alert('Error submitting report: ' + error.message);
            } 
        });

        document.getElementById('reportLostForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Get form values (backend)
            const itemName = document.getElementById('lostItemName').value;
            const itemCategory = document.getElementById('lostItemCategory').value;
            const color = document.getElementById('lostColor').value;
            const location = document.getElementById('lostLocation').value;
            const dateLost = document.getElementById('dateLost').value;
            // const contactMethod = document.getElementById('lostContactMethod').value;
            const description = document.getElementById('lostDescription').value;
            const user = auth.currentUser;
            const userRef = doc(db, "users", user.uid);

            if (!user) {
                alert("Please log in to submit a lost report.");
                return;
            }

            // Set uploaded files
            const files = lostItemUploader.getFiles();

            try {
                // Upload image to Cloudinary
                const imageURLs = [];
                for (const file of files) {
                    const formData = new FormData();
                    formData.append('file', file);
                    formData.append('upload_preset', 'lost_found_upload');

                    const response = await fetch('https://api.cloudinary.com/v1_1/dnshn1lze/image/upload', {
                        method: "POST",
                        body: formData
                    });

                    const data = await response.json();
                    if (!data.secure_url) throw new Error('Image upload failed');
                    imageURLs.push(data.secure_url);
                }

                // prepare Firestore lost report data
                const reportData = {
                    itemCategory: itemCategory,
                    itemColor: color,
                    dateLost: Timestamp.fromDate(new Date(dateLost)),
                    description: description,
                    images: imageURLs,
                    itemName: itemName,
                    lastSeenLocation: location, 
                    userRef: userRef,
                    // contactMethod: contactMethod,
                    createdAt: serverTimestamp()
                };

                // Save to Firestore
                const db = getFirestore();
                const docRef = await addDoc(collection(db, 'lostItems'), reportData);

                // Show success message (simulated)
                lostItemForm.innerHTML = `
                    <div class="text-center py-8">
                        <div class="bg-red-100 p-3 rounded-full inline-flex items-center justify-center mb-4">
                            <i class="fas fa-check-circle text-red-600 text-4xl"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">Report Submitted Successfully!</h2>
                        <p class="text-gray-600 mb-6">We'll notify you if someone finds an item matching your description.</p>
                        <div class="flex justify-center">
                            <button id="lostReturnHome" class="btn-primary bg-red-500 hover:bg-red-600">
                                <i class="fas fa-home mr-2"></i>Return to Home
                            </button>
                        </div>
                    </div>
                `;

                console.log('Lost Report Created Successfully by ', user.uid);

                // // Add event listener to new button
                // document.getElementById('lostReturnHome').addEventListener('click', function() {
                //     window.location.href = 'index.html';
                // });

                // With this deferred approach:
                setTimeout(() => {
                    const returnBtn = document.getElementById('lostReturnHome');
                    if (returnBtn) {
                        returnBtn.addEventListener('click', () => {
                            window.location.href = 'my-reports.html';
                        });
                    }
                }, 0);

            } catch (error) {
                console.error('Submission error: ', error);
                alert('Error submitting report: ' + error.message);
            } 
        });
    </script>
</body>
</html>